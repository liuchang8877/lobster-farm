<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>技能市场</title>
  <style>
    :root {
      --cream-50: #fffaf2;
      --cream-100: #f9f1e3;
      --cream-200: #f3e4ce;
      --cream-300: #edd6b8;
      --caramel-500: #b87f4a;
      --caramel-600: #9b6a3b;
      --coffee-700: #6c4a2f;
      --ink-800: #3b2b1f;
      --leaf-500: #6b8f5a;
      --shadow: 0 10px 30px rgba(59, 43, 31, 0.08);
      --radius: 16px;
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: "Iowan Old Style", "Georgia", "Times New Roman", serif;
      color: var(--ink-800);
      background: radial-gradient(1200px 600px at 10% -10%, #fffdf7 0%, var(--cream-50) 50%, var(--cream-100) 100%);
    }

    header {
      padding: 48px 16px 24px;
      text-align: center;
    }

    .title {
      font-size: clamp(28px, 4vw, 48px);
      letter-spacing: 1px;
      margin: 0 0 8px;
    }

    .subtitle {
      margin: 0 auto;
      max-width: 680px;
      color: var(--coffee-700);
      font-size: 16px;
      line-height: 1.7;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 0 16px 64px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-top: 24px;
    }

    .card {
      background: linear-gradient(160deg, #ffffff 0%, var(--cream-100) 100%);
      border: 1px solid var(--cream-200);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 10px;
      min-height: 200px;
    }

    .badge {
      align-self: flex-start;
      background: var(--cream-200);
      color: var(--coffee-700);
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      letter-spacing: 0.4px;
    }

    .card h3 {
      margin: 0;
      font-size: 20px;
    }

    .meta {
      font-size: 13px;
      color: var(--caramel-600);
    }

    .tags {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    .tag {
      font-size: 12px;
      background: var(--cream-300);
      color: var(--coffee-700);
      padding: 3px 8px;
      border-radius: 999px;
    }

    .section {
      margin-top: 48px;
      background: linear-gradient(160deg, #fffdf8 0%, var(--cream-100) 100%);
      border: 1px solid var(--cream-200);
      border-radius: var(--radius);
      padding: 24px;
      box-shadow: var(--shadow);
    }

    .top-nav {
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(255, 250, 242, 0.9);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid var(--cream-200);
    }

    .top-nav .nav-wrap {
      max-width: 1100px;
      margin: 0 auto;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .brand {
      font-weight: 700;
      letter-spacing: 1px;
      color: var(--coffee-700);
    }

    .nav-links {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    .nav-links a {
      text-decoration: none;
      color: var(--coffee-700);
      background: var(--cream-100);
      border: 1px solid var(--cream-200);
      padding: 6px 14px;
      border-radius: 999px;
      font-size: 14px;
    }

    .hero-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 18px;
      margin-top: 20px;
    }

    .feature-card {
      background: linear-gradient(140deg, #fff 0%, #fff5e8 100%);
      border: 1px solid var(--cream-200);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 170px;
    }

    .feature-card .badge {
      background: var(--cream-300);
    }

    .scene-card {
      background: linear-gradient(160deg, #fffaf2 0%, #f7ead6 100%);
      border: 1px solid var(--cream-200);
      border-radius: var(--radius);
      padding: 18px;
      box-shadow: var(--shadow);
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-height: 160px;
    }

    .leaderboard {
      display: grid;
      gap: 12px;
      margin-top: 16px;
    }

    .leaderboard-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 12px 16px;
      background: #fff;
      border: 1px solid var(--cream-200);
      border-radius: 12px;
      box-shadow: var(--shadow);
    }

    .leaderboard-meta {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .rank {
      font-size: 12px;
      color: var(--caramel-600);
    }

    .score {
      font-weight: 700;
      color: var(--coffee-700);
    }

    form {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 12px;
    }

    label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-size: 14px;
      color: var(--coffee-700);
    }

    input, textarea, select {
      border: 1px solid var(--cream-300);
      border-radius: 12px;
      padding: 10px 12px;
      font-size: 14px;
      background: #fff;
      color: var(--ink-800);
      font-family: inherit;
    }

    textarea { min-height: 100px; grid-column: 1 / -1; }

    .actions {
      display: flex;
      gap: 12px;
      align-items: center;
      grid-column: 1 / -1;
    }

    button {
      border: none;
      background: var(--caramel-500);
      color: #fff;
      padding: 10px 18px;
      border-radius: 999px;
      font-size: 14px;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      box-shadow: 0 8px 20px rgba(184, 127, 74, 0.3);
    }

    button:hover { transform: translateY(-1px); }

    .status {
      font-size: 13px;
      color: var(--leaf-500);
    }

    .error {
      color: #a44b2f;
    }

    .empty {
      text-align: center;
      padding: 32px 12px;
      color: var(--coffee-700);
      background: var(--cream-100);
      border-radius: var(--radius);
      border: 1px dashed var(--cream-300);
    }
  </style>
</head>
<body>
  <header>
    <h1 class="title">龙虾技能市场</h1>
    <p class="subtitle">在温暖的奶油色调里，发现被审核通过的技能包，也可以提交你的技能，等待上架。</p>
  </header>

  <nav class="top-nav">
    <div class="nav-wrap">
      <div class="brand">Lobster Lab</div>
      <div class="nav-links">
        <a href="#breeds">品种</a>
        <a href="#skills-section">技能</a>
        <a href="#scenes">场景</a>
        <a href="#creators">创作者</a>
      </div>
    </div>
  </nav>

  <main class="container">
    <section id="breeds">
      <h2>精选品种</h2>
      <p class="subtitle">挑选与你的团队调性最合拍的龙虾品种，为工作流注入新灵感。</p>
      <div class="hero-grid">
        <article class="feature-card">
          <span class="badge">统筹</span>
          <h3>司令龙虾</h3>
          <div class="meta">擅长战略规划与节奏把控</div>
          <p>适合需要跨团队协作、推进复杂项目的场景。</p>
        </article>
        <article class="feature-card">
          <span class="badge">精研</span>
          <h3>厨师龙虾</h3>
          <div class="meta">细节敏锐、流程稳定</div>
          <p>在高要求交付与稳定执行中表现出色。</p>
        </article>
        <article class="feature-card">
          <span class="badge">硬核</span>
          <h3>钳工龙虾</h3>
          <div class="meta">擅长工具链与工程化整合</div>
          <p>帮你把零散技能打磨成可复用的流水线。</p>
        </article>
        <article class="feature-card">
          <span class="badge">灵感</span>
          <h3>浪花龙虾</h3>
          <div class="meta">创意迭代、表达多元</div>
          <p>适合内容生产、品牌风格探索与设计任务。</p>
        </article>
        <article class="feature-card">
          <span class="badge">守护</span>
          <h3>岩礁龙虾</h3>
          <div class="meta">稳定性与风险控制</div>
          <p>提供结构化检查与合规提醒，降低返工。</p>
        </article>
        <article class="feature-card">
          <span class="badge">效率</span>
          <h3>航海龙虾</h3>
          <div class="meta">快速对齐目标、拆解任务</div>
          <p>适合短周期冲刺或多项目并行管理。</p>
        </article>
      </div>
    </section>

    <section id="scenes" class="section">
      <h2>应用场景</h2>
      <p class="subtitle">把技能包投放到合适的场景，产出会更丝滑。</p>
      <div class="hero-grid">
        <article class="scene-card">
          <span class="badge">企业</span>
          <h3>企业协作</h3>
          <p>统一标准、沉淀流程，释放大团队协作效率。</p>
        </article>
        <article class="scene-card">
          <span class="badge">个人</span>
          <h3>个人工作室</h3>
          <p>轻量工具加速创作节奏，保持灵感与执行力。</p>
        </article>
        <article class="scene-card">
          <span class="badge">学术</span>
          <h3>学术研究</h3>
          <p>快速梳理文献、实验流程与研究记录。</p>
        </article>
        <article class="scene-card">
          <span class="badge">电商</span>
          <h3>电商增长</h3>
          <p>搭建选品、内容与运营闭环，提高转化率。</p>
        </article>
      </div>
    </section>

    <section id="creators" class="section">
      <h2>创作者排行榜</h2>
      <p class="subtitle">感谢持续产出优秀技能包的创作者。</p>
      <div class="leaderboard">
        <div class="leaderboard-item">
          <div class="leaderboard-meta">
            <span class="rank">NO.1</span>
            <strong>林深工作室</strong>
            <span class="meta">代表作：自动化脚本助手</span>
          </div>
          <span class="score">累计下载 4,820</span>
        </div>
        <div class="leaderboard-item">
          <div class="leaderboard-meta">
            <span class="rank">NO.2</span>
            <strong>奶油工坊</strong>
            <span class="meta">代表作：品牌叙事编织机</span>
          </div>
          <span class="score">累计下载 4,120</span>
        </div>
        <div class="leaderboard-item">
          <div class="leaderboard-meta">
            <span class="rank">NO.3</span>
            <strong>半岛实验室</strong>
            <span class="meta">代表作：研究数据整理器</span>
          </div>
          <span class="score">累计下载 3,760</span>
        </div>
        <div class="leaderboard-item">
          <div class="leaderboard-meta">
            <span class="rank">NO.4</span>
            <strong>浪花创作队</strong>
            <span class="meta">代表作：多平台内容派发器</span>
          </div>
          <span class="score">累计下载 3,420</span>
        </div>
      </div>
    </section>

    <section>
      <h2 id="skills-section">已上架技能</h2>
      <div id="skills" class="grid"></div>
      <div id="empty" class="empty" style="display:none;">暂时没有已通过的技能。</div>
    </section>

    <section class="section">
      <h2>提交新技能</h2>
      <p class="subtitle">填写后将提交为 `pending`，审核通过后展示在上方市场。</p>
      <form id="skillForm">
        <label>
          技能名称
          <input type="text" name="name" required maxlength="50" placeholder="例如：自动化脚本助手" />
        </label>
        <label>
          类型
          <select name="type" required>
            <option value="">请选择</option>
            <option>编程</option>
            <option>搜索</option>
            <option>写作</option>
            <option>浏览器</option>
            <option>记忆</option>
            <option>设计</option>
          </select>
        </label>
        <label>
          标签（逗号分隔）
          <input type="text" name="tags" placeholder="例如：效率, 工作流" />
        </label>
        <label>
          描述
          <textarea name="description" placeholder="简要介绍你的技能包"></textarea>
        </label>
        <div class="actions">
          <button type="submit">提交审核</button>
          <span id="formStatus" class="status"></span>
        </div>
      </form>
    </section>
  </main>

  <script>
    const SUPABASE_URL = "https://thpamcdbcfnmhvnmvhtc.supabase.co";
    const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRocGFtY2RiY2ZubWh2bm12aHRjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIxNTg5MTIsImV4cCI6MjA4NzczNDkxMn0.7Mgl8AE6au-ICi22U8R7u2MFQqKyd1EP0-a-PsC6c2w";

    const skillsEl = document.getElementById("skills");
    const emptyEl = document.getElementById("empty");
    const form = document.getElementById("skillForm");
    const formStatus = document.getElementById("formStatus");

    const headers = {
      apikey: SUPABASE_KEY,
      Authorization: `Bearer ${SUPABASE_KEY}`,
      "Content-Type": "application/json",
      Prefer: "return=representation"
    };

    function tagPills(tags) {
      if (!Array.isArray(tags) || tags.length === 0) return "";
      return `<div class="tags">${tags.map(t => `<span class="tag">${t}</span>`).join("")}</div>`;
    }

    function renderSkills(list) {
      skillsEl.innerHTML = "";
      if (!list.length) {
        emptyEl.style.display = "block";
        return;
      }
      emptyEl.style.display = "none";
      for (const skill of list) {
        const card = document.createElement("article");
        card.className = "card";
        card.innerHTML = `
          <span class="badge">${skill.type || "未分类"}</span>
          <h3>${skill.name}</h3>
          <div class="meta">下载 ${skill.downloads ?? 0} 次</div>
          <p>${skill.description || "暂无描述"}</p>
          ${tagPills(skill.tags)}
        `;
        skillsEl.appendChild(card);
      }
    }

    async function loadSkills() {
      try {
        const url = `${SUPABASE_URL}/rest/v1/skills?select=id,name,type,description,tags,downloads,status&status=eq.approved&order=created_at.desc`;
        const res = await fetch(url, { headers });
        if (!res.ok) throw new Error(await res.text());
        const data = await res.json();
        renderSkills(data);
      } catch (err) {
        emptyEl.style.display = "block";
        emptyEl.textContent = "加载失败，请稍后再试。";
        console.error(err);
      }
    }

    form.addEventListener("submit", async (event) => {
      event.preventDefault();
      formStatus.textContent = "提交中...";
      formStatus.classList.remove("error");

      const formData = new FormData(form);
      const tagsText = formData.get("tags")?.toString().trim();
      const payload = {
        name: formData.get("name").toString().trim(),
        type: formData.get("type").toString().trim(),
        description: formData.get("description").toString().trim(),
        tags: tagsText ? tagsText.split(",").map(t => t.trim()).filter(Boolean) : [],
        status: "pending"
      };

      if (!payload.name || !payload.type) {
        formStatus.textContent = "请补全必填字段。";
        formStatus.classList.add("error");
        return;
      }

      try {
        const res = await fetch(`${SUPABASE_URL}/rest/v1/skills`, {
          method: "POST",
          headers,
          body: JSON.stringify(payload)
        });
        if (!res.ok) throw new Error(await res.text());
        formStatus.textContent = "提交成功，等待审核。";
        form.reset();
      } catch (err) {
        formStatus.textContent = "提交失败，请稍后再试。";
        formStatus.classList.add("error");
        console.error(err);
      }
    });

    loadSkills();
  </script>
</body>
</html>
